<div cdkDropListGroup>

    <div class="std-border">
        <div *ngFor="let tier of rankingData?.tierListData?.tiers; let i = index"
            class="flex items-start justify-between w-full min-h-32 std-shaded-bg std-border-b"
        >
            <div
                [style.background-color]="tier.color"
                class="flex items-center justify-center min-w-24 text-lg font-semibold self-stretch flex-shrink-0"
            >
                {{ tier.name }}
            </div>

            <div
                cdkDropList
                [cdkDropListData]="rankingData.tierListData!.tierMovies[tier.name]!"
                (cdkDropListDropped)="drop($event)"
                [id]="tier.name"
                class="flex flex-grow flex-wrap items-start gap-0.5 overflow-hidden min-h-32 p-1 relative z-0" style="transform: translateZ(0);" [cdkDropListOrientation]="'mixed'"
            >
                <div
                    *ngFor="let movie of rankingData.tierListData!.tierMovies[tier.name]!"
                    cdkDrag
                    [cdkDragData]="movie"
                    class="flex-shrink-0 w-20 h-32 cursor-grab movie-item mr-0.5"
                >
                    <img
                        [src]="movie.posterUrl"
                        alt="{{ movie.title }} Poster"
                        class="w-full h-full object-cover rounded-md shadow-md"
                    >
                    <div *cdkDragPreview class="w-20 h-32">
                        <img [src]="movie.posterUrl" class="w-full h-full object-cover rounded-md opacity-50">
                    </div>
                    <div *cdkDragPlaceholder class="w-20 h-32 bg-gray-300 opacity-50 rounded-md"></div>
                </div>
            </div>

            <div class="flex items-center justify-center space-x-4 std-bg px-4 std-shaded-text text-3xl self-stretch flex-shrink-0">
                <button (click)="openTierSettings(i)" type="button" class="cursor-pointer">
                    <fa-icon [icon]="faGear" />
                </button>
                <div class="flex flex-col">
                    <button (click)="moveTierUp(i)" type="button" class="cursor-pointer"
                        [disabled]="i === 0"
                        [class.opacity-50]="i === 0"
                    >
                        <fa-icon [icon]="faCaretUp" />
                    </button>
                    <button (click)="moveTierDown(i)" type="button" class="cursor-pointer"
                        [disabled]="i === (rankingData.tierListData?.tiers?.length || 0) - 1"
                        [class.opacity-50]="i === (rankingData.tierListData?.tiers?.length || 0) - 1"
                    >
                        <fa-icon [icon]="faCaretDown" />
                    </button>
                </div>
            </div>

            <div *ngIf="openedSettingsTierIndex === i" class="absolute inset-0 flex items-center justify-center z-40 std-bg">
                <app-tier-settings-dialog
                    [tierColorOptions]="TIER_COLOR_OPTIONS"
                    [tierName]="tier.name"
                    [selectedColor]="tier.color"
                    (requestConfirm)="confirmTierSettings($event, i)"
                    (requestClose)="closeTierSettings()"
                    (requestDeleteTier)="deleteTier()"
                    (requestClearImages)="clearTierImages()"
                    (requestAddRowAbove)="addTierRow($event)"
                ></app-tier-settings-dialog>
            </div>
        </div>
    </div>

    <div class="py-4">
        <div
            cdkDropList
            [cdkDropListData]="rankingData!.tierListData!.availableMovies"
            (cdkDropListDropped)="drop($event)"
            id="available-movies"
            class="flex flex-wrap my-4 gap-2 std-border p-4 rounded-md min-h-32 relative z-0" [cdkDropListOrientation]="'mixed'"
        >
            <div *ngFor="let movie of rankingData?.tierListData?.availableMovies"
                cdkDrag
                [cdkDragData]="movie" class="flex-shrink-0 w-20 h-32 cursor-grab movie-item mr-0.5"
            >
                <img
                    [src]="movie.posterUrl"
                    alt="{{ movie.title }} Poster"
                    class="w-full h-full object-cover rounded-md shadow-md"
                >
                <div *cdkDragPreview class="w-20 h-32">
                    <img [src]="movie.posterUrl" class="w-full h-full object-cover rounded-md opacity-50">
                </div>
                <div *cdkDragPlaceholder class="w-20 h-32 bg-gray-300 opacity-50 rounded-md"></div>
            </div>
            <div *ngIf="!rankingData?.tierListData?.availableMovies?.length" class="text-gray-500 text-sm w-full text-center italic p-2">
                No movies available. Import some!
            </div>
        </div>

        <button class="standard-action-button" type="button" (click)="importMovies()">
            Import Movies
        </button>
    </div>
</div>